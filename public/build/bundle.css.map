{
  "version": 3,
  "file": "bundle.css",
  "sources": [
    "..\\..\\OffworksStatsTable.svelte"
  ],
  "sourcesContent": [
    "<script>\r\n    import Table from \"sveltestrap/src/Table.svelte\";\r\n    import Button from  \"sveltestrap/src/Button.svelte\";\r\n    import { Pagination, PaginationItem, PaginationLink } from 'sveltestrap';\r\n    import Input from \"sveltestrap/src/Input.svelte\";\r\n\timport Label from \"sveltestrap/src/Label.svelte\";\r\n\timport FormGroup from \"sveltestrap/src/FormGroup.svelte\";\r\n\r\n    import { pop } from \"svelte-spa-router\"\r\n    \r\n    import { onMount } from \"svelte\";\r\n\r\n    let offworks = [];\r\n    \r\n    let offwork = {\r\n        community: \"\",\r\n        year: \"\",\r\n        accident: \"\",\r\n        sick: \"\",\r\n        numberzone: \"\"\r\n\t};\r\n\tlet searchOff = {\r\n\t\tcommunity: \"\",\r\n        year: \"\",\r\n        accident: \"\",\r\n        sick: \"\",\r\n        numberzone: \"\"\r\n\t};\r\n\r\n\tlet limit = 10;\r\n\tlet offset = 0;\r\n\tlet msgOk = false;\r\n\tlet msgErr = false;\r\n\tlet actualPag = 1;\r\n\tlet Pagsig = true;\r\n\tlet njson=0;\r\n\t//let njsonbusqueda=0;\r\n\tlet msgOkBusq = false;\r\n\tlet msgErrBusq = false;\r\n\tlet campo=\"\";\r\n\tlet value=\"\";\r\n\tlet conjCommunity= [];\r\n\tlet conjYears = [];\r\n\tlet y = \"-\";\r\n\tlet c = \"-\";\r\n\tlet communityOn = false;\r\n\tlet yearOn = false;\r\n\t//let accidentOn = false;\r\n\t//let sickOn = false;\r\n\t//let numberZoneOn = false;\r\n    onMount(getOffworksPag);\r\n\r\n    async function loadInitialData() {\r\n        const res = await fetch(\"/api/v2/offworks-stats/loadInitialData\", {\r\n            method: \"GET\"\r\n        }).then(function (res) {\r\n\t\t\tgetOffworksPag();\r\n\t\t\tif(res.status == 200){\r\n\t\t\t\tmsgOk = \"Datos iniciales cargados correctamente \";\r\n\t\t\t\tmsgErr = false;\r\n\t\t\t}\r\n        });\r\n\t}\r\n\r\n    async function getOffworksPag(){\r\n\r\n\t\tconsole.log(\"Fetching Offworks...\"+offset+\" \"+(offset+1));\r\n\t\tconst res = await fetch(\"/api/v2/offworks-stats?offset=\" + limit * offset + \"&limit=\" + limit);\r\n\t\tconst resConj = await fetch(\"/api/v2/offworks-stats\");\r\n\t\tif (res.ok){\r\n\t\t\tconsole.log(\"Ok\");\r\n\t\t\tconst json = await res.json();\r\n\t\t\toffworks = json;\r\n\t\t\tnjson=json.length;\r\n\t\t\t//console.log(json.length);\r\n\r\n\t\t\tconst json2 = await resConj.json();\r\n\t\t\tconjCommunity = json2.map((c) => {\r\n\t\t\t\t\treturn c.community;\r\n\t\t\t});\r\n\t\t\tconjCommunity = Array.from(new Set(conjCommunity)); \r\n\t\t\tconjYears = json2.map((y) => {\r\n\t\t\t\t\treturn y.year;\r\n\t\t\t});\r\n\t\t\tconjYears = Array.from(new Set(conjYears));\r\n\r\n\t\t\tif (json.length ==0){\r\n\t\t\t\tPagsig = false;\r\n\t\t\t}else{\r\n\t\t\t\tPagsig = true;\r\n\t\t\t}\r\n\t\t\tconsole.log(\"Received \"+offworks.length+\" offworks\");\r\n\t\t}else if(res.status == 404){\r\n\t\t\tconsole.log(\"Error\");\r\n\t\t\tPagsig = false;\r\n\t\t}\r\n\t}\r\n\r\n    async function insertOffworks() {\r\n        console.log(\"Inserting offworks-stats...\" + JSON.stringify(offwork));\r\n        const res = await fetch(\"/api/v2/offworks-stats\", {\r\n            method: \"POST\",\r\n            body: JSON.stringify(offwork),\r\n            headers: {\r\n                \"Content-Type\": \"application/json\"\r\n            }\r\n        }).then(function (res) {\r\n            getOffworksPag();\r\n            if(res.status == 201){\r\n\t\t\t\tmsgOk = \"Se ha añadido correctamente\";\r\n\t\t\t\tmsgErr = false;\r\n\t\t\t}else if(res.status == 400){\r\n\t\t\t\tmsgOk = false;\r\n\t\t\t\tmsgErr = \"No puede estar ningun campo vacio\";\r\n\t\t\t}else{\r\n\t\t\t\tmsgOk = false;\r\n\t\t\t\tmsgErr = \"Ya existe\";\r\n\t\t\t}\r\n        });\r\n    }\r\n\r\n    async function deleteOffwors(community, year) {\r\n        console.log(\"Deleting Offworks...\");\r\n\t\tconst res = await fetch(\"/api/v2/offworks-stats/\"+community+\"/\"+year, {\r\n\t\t\tmethod: \"DELETE\"\r\n\t\t}).then(function (res) {\r\n            getOffworksPag();\r\n\t\t\tif(res.status == 200){\r\n\t\t\t\tmsgOk = \"Dato borrado correctamente\";\r\n\t\t\t\tmsgErr = false;\r\n\t\t\t}\r\n\t\t});\r\n    }\r\n\r\n    async function deleteAllOffworks() {\r\n\t    console.log(\"Deleting All Offworks...\");\r\n\t\tconst res = await fetch(\"/api/v2/offworks-stats\", {\r\n\t\t\tmethod: \"DELETE\"\r\n\t\t}).then(function (res) {\r\n            getOffworksPag();\r\n\t\t\tif(res.status == 200){\r\n\t\t\t\tmsgOk = \"Dato borrado correctamente\";\r\n\t\t\t\tmsgErr = false;\r\n\t\t\t\tlocation.reload();\r\n\t\t\t}else{\r\n\t\t\t\tmsgOk = false;\r\n\t\t\t\tmsgErr=\"Error\";\r\n\t\t\t\t//location.reload();\r\n\t\t\t}\r\n\t\t});\r\n    }\r\n\r\n\r\n\tasync function searchComAndYear(community, year) {\r\n\t\toffset = 0;\r\n\t\tactualPag = 1; \r\n        Pagsig = false;\r\n\t\tconsole.log(\"Searching data: \" + community + \" and \" + year);\r\n\t\tvar url = \"/api/v2/offworks-stats\";\r\n\t\tif (community != \"-\" && year != \"-\") {\r\n\t\t\turl = url + \"?community=\" + community + \"&year=\" + year; \r\n\t\t} else if (community != \"-\" && year == \"-\") {\r\n\t\t\turl = url + \"?community=\" + community;\r\n\t\t} else if (community == \"-\" && year != \"-\") {\r\n\t\t\turl = url + \"?year=\" + year;\r\n\t\t}\r\n\t\tconsole.log(\"url: \" + url);\r\n\t\tconst res = await fetch(url);\r\n\t\tif (res.ok) {\r\n\t\t\tconsole.log(\"Ok:\");\r\n\t\t\tconst json = await res.json();\r\n\t\t\toffworks = json;\r\n\t\t\tconsole.log(\"Found \" + offworks.length + \" offworks.\");\r\n\t\t\tmsgOkBusq = \"Busqueda realizada\";\r\n\t\t\tmsgErrBusq = false;\r\n\t\t} else {\r\n\t\t\tmsgOkBusq = false;\r\n\t\t\tmsgErrBusq = \"No hay resultados\";\r\n\t\t\tconsole.log(\"ERROR!\");\r\n\t\t}\r\n\t\t\r\n\t}\r\n\r\n</script>\r\n\r\n\r\n<main>\r\n\t\r\n\t{#await offworks}\r\n\t\tLoading offworks...\r\n\t{:then offworks}\r\n\t\r\n\t<h4>Busqueda por comunidad y/o año</h4>\r\n\t<div style=\"display: inline-block;width: 10%;\" >\r\n\t\t<FormGroup style=\"width:100%;\"> \r\n\t\t\t<Label for=\"selectComunnity\"> Comunidad </Label>\r\n\t\t\t<Input type=\"select\" name=\"selectComunnity\" id=\"selectComunnity\" bind:value=\"{c}\">\r\n\t\t\t\t{#each conjCommunity as community}\r\n\t\t\t\t<option>{community}</option>\r\n\t\t\t\t{/each}\r\n\t\t\t\t<option>-</option>\r\n\t\t\t</Input>\r\n\t\t</FormGroup>\r\n\t</div>\t\r\n\t<div style=\"margin: 2px 10px;display:inline-block;width: 10%;\">\r\n\t\t<FormGroup style=\"width:100%;\"> \r\n\t\t\t<Label for=\"selectYear\"> Año </Label>\r\n\t\t\t<Input type=\"select\"  name=\"selectYear\" id=\"selectYear\" bind:value=\"{y}\">\r\n\t\t\t\t{#each conjYears as year}\r\n\t\t\t\t<option>{year}</option>\r\n\t\t\t\t{/each}\r\n\t\t\t\t<option>-</option>\r\n\t\t\t</Input>\r\n\t\t</FormGroup>\r\n\t</div>\r\n\t<div style=\"margin: 2px 10px;display:inline-block;\">\r\n\t\t<Button color=\"info\" on:click=\"{searchComAndYear(c,y)}\"> Buscar </Button>\r\n\t</div>\r\n\t{#if msgErrBusq}\r\n        <p style=\"color: red\">ERROR: {msgErrBusq}</p>\r\n\t{/if}\r\n\t{#if msgOkBusq}\r\n        <p style=\"color: green\">EXITO: {msgOkBusq}</p>\r\n\t{/if}\r\n\t\t<Table bordered >\r\n\t\t\t<thead >\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<th>Comunidad</th>\r\n\t\t\t\t\t<th>Año</th>\r\n\t\t\t\t\t<th>Accidentes</th>\r\n\t\t\t\t\t<th>Enfermedades</th>\r\n\t\t\t\t\t<th>Numero de zonas</th>\r\n\t\t\t\t\t<th>Acciones</th>\r\n\t\t\t\t</tr>\r\n\t\t\t</thead>\r\n\t\t\t<tbody>\r\n\t\t\t\t{#each offworks as off}\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td><a style=\"text-align: center;\" href=\"#/offworks-stats/{off.community}/{off.year}\">{off.community}</a></td>\r\n\t\t\t\t\t\t<td>{off.year}</td>\r\n\t\t\t\t\t\t<td>{off.accident}</td>\r\n\t\t\t\t\t\t<td>{off.sick}</td>\r\n\t\t\t\t\t\t<td>{off.numberzone}</td>\r\n\t\t\t\t\t\t<td> <Button outline color=\"danger\" on:click=\"{deleteOffwors(off.community, off.year)}\">\r\n\t\t\t\t\t\t\tBorrar </Button> </td> <!--Borrar un recurso-->\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t{/each}\r\n\t\t\t\t<tr style=\"background-color:rgba(217, 219, 255, 0.945);\">\r\n\t\t\t\t\t<td><Input type=\"text\" bind:value=\"{offwork.community}\"/></td>\r\n\t\t\t\t\t<td><Input type=\"number\" bind:value=\"{offwork.year}\"/></td>\r\n\t\t\t\t\t<td><Input type=\"number\" bind:value=\"{offwork.accident}\"/></td>\r\n\t\t\t\t\t<td><Input type=\"number\" bind:value=\"{offwork.sick}\"/></td>\r\n\t\t\t\t\t<td><Input type=\"number\" bind:value=\"{offwork.numberzone}\"/></td>\r\n\t\t\t\t\t<td> <Button  color=\"primary\" on:click={insertOffworks}> Añadir</Button> </td>\t\r\n\t\t\t\t</tr>\r\n\t\t\t</tbody>\r\n\t\t</Table>\r\n\t{/await}\r\n\r\n\t{#if msgErr}\r\n        <p style=\"color: red\">ERROR: {msgErr}</p>\r\n\t{/if}\r\n\t{#if msgOk}\r\n        <p style=\"color: green\">EXITO: {msgOk}</p>\r\n\t{/if}\r\n\t\r\n\t<Pagination style=\"padding-left: 40%\" ariaLabel=\"Cambio de página\">\r\n\t\t{#if actualPag != 1}\r\n\t\t<PaginationItem class=\"{actualPag === 1 ? 'disabled' : ''}\">\r\n\t\t\t<PaginationLink previous href=\"#/offworks-stats\" on:click=\"{() => sumOffset(-1)}\" />\r\n\t   </PaginationItem>\r\n\r\n\t\t<PaginationItem>\r\n\t\t\t<PaginationLink href=\"#/offworks-stats\" on:click=\"{() => sumOffset(-1)}\" >{actualPag - 1}</PaginationLink>\r\n\t\t</PaginationItem>\r\n\t\t{/if}\r\n\t\t<PaginationItem active>\r\n\t\t\t<PaginationLink href=\"#/offworks-stats\" >{actualPag}</PaginationLink>\r\n\t\t</PaginationItem>\r\n\r\n\t\t{#if Pagsig && njson>=9}\r\n\t\t<PaginationItem >\r\n\t\t\t<PaginationLink href=\"#/offworks-stats\" on:click=\"{() => sumOffset(1)}\">{actualPag + 1}</PaginationLink>\r\n\t\t</PaginationItem>\r\n\t\t\r\n\r\n\t\t<PaginationItem class=\"{Pagsig ? '' : 'disabled'}\">\r\n\t\t  <PaginationLink next href=\"#/offworks-stats\" on:click=\"{() => sumOffset(1)}\"/>\r\n\t\t</PaginationItem>\r\n\t\t{/if}\r\n\r\n\t\t\r\n\t</Pagination>\r\n\r\n<Button outline color=\"secondary\" on:click=\"{pop}\"> Volver </Button>\r\n<Button outline on:click={deleteAllOffworks} color=\"danger\"> <i class=\"fa fa-trash\" aria-hidden=\"true\"></i>Borrar todo </Button> <!--Borrar todos recursos-->\r\n<Button outline on:click={loadInitialData} color=\"primary\"> <i class=\"fas fa-download\"></i> Cargar Datos Iniciales </Button>\r\n</main>\r\n\r\n<style>\r\n\ttd {text-align: center;} \r\n\tth {text-align: center;} \r\n\t\r\n</style>\r\n"
  ],
  "names": [],
  "mappings": "AA6SC,EAAE,cAAC,CAAC,UAAU,CAAE,MAAM,AAAC,CAAC,AACxB,EAAE,cAAC,CAAC,UAAU,CAAE,MAAM,AAAC,CAAC"
}