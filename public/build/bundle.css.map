{
  "version": 3,
  "file": "bundle.css",
  "sources": [
    "../../OffworksStatsTable.svelte"
  ],
  "sourcesContent": [
    "<script>\n    import Table from \"sveltestrap/src/Table.svelte\";\n    import Button from  \"sveltestrap/src/Button.svelte\";\n    import { Pagination, PaginationItem, PaginationLink } from 'sveltestrap';\n    import Input from \"sveltestrap/src/Input.svelte\";\n\timport Label from \"sveltestrap/src/Label.svelte\";\n\timport FormGroup from \"sveltestrap/src/FormGroup.svelte\";\n\n    import { pop } from \"svelte-spa-router\"\n    \n    import { onMount } from \"svelte\";\n\n    let offworks = [];\n    \n    let offwork = {\n        community: \"\",\n        year: \"\",\n        accident: \"\",\n        sick: \"\",\n        numberzone: \"\"\n\t};\n\tlet searchOff = {\n\t\tcommunity: \"\",\n        year: \"\",\n        accident: \"\",\n        sick: \"\",\n        numberzone: \"\"\n\t};\n\n\tlet limit = 10;\n\tlet offset = 0;\n\tlet msgOk = false;\n\tlet msgErr = false;\n\tlet actualPag = 1;\n\tlet Pagsig = true;\n\tlet njson=0;\n\t//let njsonbusqueda=0;\n\tlet msgOkBusq = false;\n\tlet msgErrBusq = false;\n\tlet campo=\"\";\n\tlet value=\"\";\n\tlet conjCommunity= [];\n\tlet conjYears = [];\n\tlet y = \"-\";\n\tlet c = \"-\";\n\tlet communityOn = false;\n\tlet yearOn = false;\n\t//let accidentOn = false;\n\t//let sickOn = false;\n\t//let numberZoneOn = false;\n    onMount(getOffworksPag);\n\n    async function loadInitialData() {\n        const res = await fetch(\"/api/v2/offworks-stats/loadInitialData\", {\n            method: \"GET\"\n        }).then(function (res) {\n\t\t\tgetOffworksPag();\n\t\t\tif(res.status == 200){\n\t\t\t\tmsgOk = \"Datos iniciales cargados correctamente \";\n\t\t\t\tmsgErr = false;\n\t\t\t}\n        });\n\t}\n\n    async function getOffworksPag(){\n\n\t\tconsole.log(\"Fetching Offworks...\"+offset+\" \"+(offset+1));\n\t\tconst res = await fetch(\"/api/v2/offworks-stats?offset=\" + limit * offset + \"&limit=\" + limit);\n\t\tconst resConj = await fetch(\"/api/v2/offworks-stats\");\n\t\tif (res.ok){\n\t\t\tconsole.log(\"Ok\");\n\t\t\tconst json = await res.json();\n\t\t\toffworks = json;\n\t\t\tnjson=json.length;\n\t\t\t//console.log(json.length);\n\n\t\t\tconst json2 = await resConj.json();\n\t\t\tconjCommunity = json2.map((c) => {\n\t\t\t\t\treturn c.community;\n\t\t\t});\n\t\t\tconjCommunity = Array.from(new Set(conjCommunity)); \n\t\t\tconjYears = json2.map((y) => {\n\t\t\t\t\treturn y.year;\n\t\t\t});\n\t\t\tconjYears = Array.from(new Set(conjYears));\n\n\t\t\tif (json.length ==0){\n\t\t\t\tPagsig = false;\n\t\t\t}else{\n\t\t\t\tPagsig = true;\n\t\t\t}\n\t\t\tconsole.log(\"Received \"+offworks.length+\" offworks\");\n\t\t}else if(res.status == 404){\n\t\t\tconsole.log(\"Error\");\n\t\t\tPagsig = false;\n\t\t}\n\t}\n\n    async function insertOffworks() {\n        console.log(\"Inserting offworks-stats...\" + JSON.stringify(offwork));\n        const res = await fetch(\"/api/v2/offworks-stats\", {\n            method: \"POST\",\n            body: JSON.stringify(offwork),\n            headers: {\n                \"Content-Type\": \"application/json\"\n            }\n        }).then(function (res) {\n            getOffworksPag();\n            if(res.status == 201){\n\t\t\t\tmsgOk = \"Se ha añadido correctamente\";\n\t\t\t\tmsgErr = false;\n\t\t\t}else if(res.status == 400){\n\t\t\t\tmsgOk = false;\n\t\t\t\tmsgErr = \"No puede estar ningun campo vacio\";\n\t\t\t}else{\n\t\t\t\tmsgOk = false;\n\t\t\t\tmsgErr = \"Ya existe\";\n\t\t\t}\n        });\n    }\n\n    async function deleteOffwors(community, year) {\n        console.log(\"Deleting Offworks...\");\n\t\tconst res = await fetch(\"/api/v2/offworks-stats/\"+community+\"/\"+year, {\n\t\t\tmethod: \"DELETE\"\n\t\t}).then(function (res) {\n            getOffworksPag();\n\t\t\tif(res.status == 200){\n\t\t\t\tmsgOk = \"Dato borrado correctamente\";\n\t\t\t\tmsgErr = false;\n\t\t\t}\n\t\t});\n    }\n\n    async function deleteAllOffworks() {\n\t    console.log(\"Deleting All Offworks...\");\n\t\tconst res = await fetch(\"/api/v2/offworks-stats\", {\n\t\t\tmethod: \"DELETE\"\n\t\t}).then(function (res) {\n            getOffworksPag();\n\t\t\tif(res.status == 200){\n\t\t\t\tmsgOk = \"Dato borrado correctamente\";\n\t\t\t\tmsgErr = false;\n\t\t\t\tlocation.reload();\n\t\t\t}else{\n\t\t\t\tmsgOk = false;\n\t\t\t\tmsgErr=\"Error\";\n\t\t\t\t//location.reload();\n\t\t\t}\n\t\t});\n    }\n\n\n\tasync function searchComAndYear(community, year) {\n\t\toffset = 0;\n\t\tactualPag = 1; \n        Pagsig = false;\n\t\tconsole.log(\"Searching data: \" + community + \" and \" + year);\n\t\tvar url = \"/api/v2/offworks-stats\";\n\t\tif (community != \"-\" && year != \"-\") {\n\t\t\turl = url + \"?community=\" + community + \"&year=\" + year; \n\t\t} else if (community != \"-\" && year == \"-\") {\n\t\t\turl = url + \"?community=\" + community;\n\t\t} else if (community == \"-\" && year != \"-\") {\n\t\t\turl = url + \"?year=\" + year;\n\t\t}\n\t\tconsole.log(\"url: \" + url);\n\t\tconst res = await fetch(url);\n\t\tif (res.ok) {\n\t\t\tconsole.log(\"Ok:\");\n\t\t\tconst json = await res.json();\n\t\t\toffworks = json;\n\t\t\tconsole.log(\"Found \" + offworks.length + \" offworks.\");\n\t\t\tmsgOkBusq = \"Busqueda realizada\";\n\t\t\tmsgErrBusq = false;\n\t\t} else {\n\t\t\tmsgOkBusq = false;\n\t\t\tmsgErrBusq = \"No hay resultados\";\n\t\t\tconsole.log(\"ERROR!\");\n\t\t}\n\t\t\n\t}\n\tasync function sumOffset(value){\n\t\toffset += value;\n\t\tactualPag += value;\n\t\tgetOffworksPag();\n\t}\n\n</script>\n\n\n<main>\n\t\n\t{#await offworks}\n\t\tLoading offworks...\n\t{:then offworks}\n\t\n\t<h4>Busqueda por comunidad y/o año</h4>\n\t<div style=\"display: inline-block;width: 10%;\" >\n\t\t<FormGroup style=\"width:100%;\"> \n\t\t\t<Label for=\"selectComunnity\"> Comunidad </Label>\n\t\t\t<Input type=\"select\" name=\"selectComunnity\" id=\"selectComunnity\" bind:value=\"{c}\">\n\t\t\t\t{#each conjCommunity as community}\n\t\t\t\t<option>{community}</option>\n\t\t\t\t{/each}\n\t\t\t\t<option>-</option>\n\t\t\t</Input>\n\t\t</FormGroup>\n\t</div>\t\n\t<div style=\"margin: 2px 10px;display:inline-block;width: 10%;\">\n\t\t<FormGroup style=\"width:100%;\"> \n\t\t\t<Label for=\"selectYear\"> Año </Label>\n\t\t\t<Input type=\"select\"  name=\"selectYear\" id=\"selectYear\" bind:value=\"{y}\">\n\t\t\t\t{#each conjYears as year}\n\t\t\t\t<option>{year}</option>\n\t\t\t\t{/each}\n\t\t\t\t<option>-</option>\n\t\t\t</Input>\n\t\t</FormGroup>\n\t</div>\n\t<div style=\"margin: 2px 10px;display:inline-block;\">\n\t\t<Button color=\"info\" on:click=\"{searchComAndYear(c,y)}\"> Buscar </Button>\n\t</div>\n\t{#if msgErrBusq}\n        <p style=\"color: red\">ERROR: {msgErrBusq}</p>\n\t{/if}\n\t{#if msgOkBusq}\n        <p style=\"color: green\">EXITO: {msgOkBusq}</p>\n\t{/if}\n\t\t<Table bordered >\n\t\t\t<thead >\n\t\t\t\t<tr>\n\t\t\t\t\t<th>Comunidad</th>\n\t\t\t\t\t<th>Año</th>\n\t\t\t\t\t<th>Accidentes</th>\n\t\t\t\t\t<th>Enfermedades</th>\n\t\t\t\t\t<th>Numero de zonas</th>\n\t\t\t\t\t<th>Acciones</th>\n\t\t\t\t</tr>\n\t\t\t</thead>\n\t\t\t<tbody>\n\t\t\t\t{#each offworks as off}\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td><a style=\"text-align: center;\" href=\"#/offworks-stats/{off.community}/{off.year}\">{off.community}</a></td>\n\t\t\t\t\t\t<td>{off.year}</td>\n\t\t\t\t\t\t<td>{off.accident}</td>\n\t\t\t\t\t\t<td>{off.sick}</td>\n\t\t\t\t\t\t<td>{off.numberzone}</td>\n\t\t\t\t\t\t<td> <Button outline color=\"danger\" on:click=\"{deleteOffwors(off.community, off.year)}\">\n\t\t\t\t\t\t\tBorrar </Button> </td> <!--Borrar un recurso-->\n\t\t\t\t\t\t\t\n\t\t\t\t\t</tr>\n\t\t\t\t{/each}\n\t\t\t\t<tr style=\"background-color:rgba(217, 219, 255, 0.945);\">\n\t\t\t\t\t<td><Input type=\"text\" bind:value=\"{offwork.community}\"/></td>\n\t\t\t\t\t<td><Input type=\"number\" bind:value=\"{offwork.year}\"/></td>\n\t\t\t\t\t<td><Input type=\"number\" bind:value=\"{offwork.accident}\"/></td>\n\t\t\t\t\t<td><Input type=\"number\" bind:value=\"{offwork.sick}\"/></td>\n\t\t\t\t\t<td><Input type=\"number\" bind:value=\"{offwork.numberzone}\"/></td>\n\t\t\t\t\t<td> <Button  color=\"primary\" on:click={insertOffworks}> Añadir</Button> </td>\t\n\t\t\t\t</tr>\n\t\t\t</tbody>\n\t\t</Table>\n\t{/await}\n\n\t{#if msgErr}\n        <p style=\"color: red\">ERROR: {msgErr}</p>\n\t{/if}\n\t{#if msgOk}\n        <p style=\"color: green\">EXITO: {msgOk}</p>\n\t{/if}\n\t\n\t<Pagination style=\"padding-left: 40%\" ariaLabel=\"Cambio de página\">\n\t\t{#if actualPag != 1}\n\t\t<PaginationItem class=\"{actualPag === 1 ? 'disabled' : ''}\">\n\t\t\t<PaginationLink previous href=\"#/offworks-stats\" on:click=\"{() => sumOffset(-1)}\" />\n\t   </PaginationItem>\n\n\t\t<PaginationItem>\n\t\t\t<PaginationLink href=\"#/offworks-stats\" on:click=\"{() => sumOffset(-1)}\" >{actualPag - 1}</PaginationLink>\n\t\t</PaginationItem>\n\t\t{/if}\n\t\t<PaginationItem active>\n\t\t\t<PaginationLink href=\"#/offworks-stats\" >{actualPag}</PaginationLink>\n\t\t</PaginationItem>\n\n\t\t{#if Pagsig && njson>=9}\n\t\t<PaginationItem >\n\t\t\t<PaginationLink href=\"#/offworks-stats\" on:click=\"{() => sumOffset(1)}\">{actualPag + 1}</PaginationLink>\n\t\t</PaginationItem>\n\t\t\n\n\t\t<PaginationItem class=\"{Pagsig ? '' : 'disabled'}\">\n\t\t  <PaginationLink next href=\"#/offworks-stats\" on:click=\"{() => sumOffset(1)}\"/>\n\t\t</PaginationItem>\n\t\t{/if}\n\n\t\t\n\t</Pagination>\n\n<Button outline color=\"secondary\" on:click=\"{pop}\"> Volver </Button>\n<Button outline on:click={deleteAllOffworks} color=\"danger\"> <i class=\"fa fa-trash\" aria-hidden=\"true\"></i>Borrar todo </Button> <!--Borrar todos recursos-->\n<Button outline on:click={loadInitialData} color=\"primary\"> <i class=\"fas fa-download\"></i> Cargar Datos Iniciales </Button>\n</main>\n\n<style>\n\ttd {text-align: center;} \n\tth {text-align: center;} \n\t\n</style>\n"
  ],
  "names": [],
  "mappings": "AAkTC,EAAE,eAAC,CAAC,UAAU,CAAE,MAAM,AAAC,CAAC,AACxB,EAAE,eAAC,CAAC,UAAU,CAAE,MAAM,AAAC,CAAC"
}